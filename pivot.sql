
----------------------------------------------------------------------------------
PIVOT TABLE 
----------------------------------------------------------------------------------



WITH sales (article_id, warehouse_id, day_id, sale_qnty) AS (
values
(101::int, 1::int, '2022-10-01'::date, 20::int),
(102, 2, '2022-10-01', 30),
(103, 3, '2022-10-01', 10),
(101, 4, '2022-10-01', 45),
(102, 5, '2022-10-01', 15),
(103, 1, '2022-10-02', 30),
(102, 2, '2022-10-02', 20),
(103, 3, '2022-10-02', 5),
(104, 4, '2022-10-02', 50),
(105, 5, '2022-10-02', 34),
(102, 1, '2022-10-03', 10),
(104, 2, '2022-10-03', 5),
(101, 3, '2022-10-03', 10),
(102, 2, '2022-10-01', 34),
(105, 2, '2022-10-01', 10),
(101, 2, '2022-10-01', 3),
(103, 2, '2022-10-01', 100),
(104, 2, '2022-10-01', 34),
(101, 2, '2022-10-01', 7)
)
SELECT 
	article_id, 
	sum(sale_qnty) FILTER (WHERE warehouse_id = 1) AS "shop 1",
	sum(sale_qnty) FILTER (WHERE warehouse_id = 2) AS "shop 2",
	sum(sale_qnty) FILTER (WHERE warehouse_id = 3) AS "shop 3",
	sum(sale_qnty) FILTER (WHERE warehouse_id = 4) AS "shop 4",
	sum(sale_qnty) FILTER (WHERE warehouse_id = 5) AS "shop 5"
FROM sales
GROUP BY article_id

/*
article_id|shop 1|shop 2|shop 3|shop 4|shop 5|
----------+------+------+------+------+------+
       101|    20|    10|    10|    45|      |
       102|    10|    84|      |      |    15|
       105|      |    10|      |      |    34|
       104|      |    39|      |    50|      |
       103|    30|   100|    15|      |      |
*/